/*!
 * peeracle v0.0.1 (https://github.com/peeracle/peeracle)
 * Copyright 2015 Axel Isouard
 * Licensed under MIT
 */
"use strict";var Peeracle=Peeracle||{};!function(){function a(a){var b,c=a,d=function(a){console.log("Peeracle.MediaChannel onerror",a)},e=function(a){console.log("Peeracle.MediaChannel onmessage",a.data)},f=function(){console.log("Peeracle.MediaChannel onopen")},g=function(){console.log("Peeracle.MediaChannel onclose")},h=function(a){b=a,b.onerror=d,b.onmessage=e,b.onopen=f,b.onclose=g},i=function(){b=c.createDataChannel("media"),h(b)},j=function(){return b.readyState};return{createDataChannel:i,setDataChannel:h,getReadyState:j}}"undefined"==typeof module?Peeracle.MediaChannel=a:module.exports=a}(),function(){function a(a){var b,c=a,d=function(a){console.log("Peeracle.SignalChannel onerror",a)},e=function(a){console.log("Peeracle.SignalChannel onmessage",a.data)},f=function(){console.log("Peeracle.SignalChannel onopen")},g=function(){console.log("Peeracle.SignalChannel onclose")},h=function(a){b=a,b.onerror=d,b.onmessage=e,b.onopen=f,b.onclose=g},i=function(){b=c.createDataChannel("signal"),h(b)},j=function(){return b.readyState};return{createDataChannel:i,setDataChannel:h,getReadyState:j}}"undefined"==typeof module?Peeracle.SignalChannel=a:module.exports=a}(),function(){function a(){var a,g,h,i=[],j=function(b){if(a&&b){var c=b.candidate;c&&(c=JSON.stringify(c));for(var d=0;d<i.length;d++)i[d].onIceCandidate(c)}},k=function(){if(a)for(var b=0;b<i.length;b++)i[b].onConnectionStateChange(a.iceConnectionState)},l=function(){},m=function(){console.log("onReadyStateChange_")},n=function(a){a&&a.channel&&("signal"===a.channel.label?g.setDataChannel(a.channel):"media"===a.channel.label&&h.setDataChannel(a.channel))},o=function(){var b={iceServers:[{url:"stun:stun.l.google.com:19302"}]};a=new c(b),a.onicecandidate=j,a.oniceconnectionstatechange=k,a.onicegatheringstatechange=l,a.ondatachannel=n,a.onreadystatechange=m,g=new f(a),h=new e(a)},p=function(a){var b=i.indexOf(a);~b||i.push(a)},q=function(a){var b=i.indexOf(a);~b&&i.splice(b,1)},r=function(b,c){var d=function(a){c(a)};o(),h.createDataChannel(),g.createDataChannel(),a.createOffer(function(c){a.setLocalDescription(c,function(){b(JSON.stringify(c))},d)},d)},s=function(b,c,e){var f=function(a){e(a)};o();var g=new d(JSON.parse(b));a.setRemoteDescription(g,function(){a.createAnswer(function(b){a.setLocalDescription(b,function(){c(JSON.stringify(b))},f)},f)},f)},t=function(b,c,e){var f=function(a){e(a)},g=new d(JSON.parse(b));a.setRemoteDescription(g,function(){c()},f)},u=function(c,d,e){a.addIceCandidate(new b(JSON.parse(c)),function(){d()},function(a){e(a)})},v=function(){a.close()};return{subscribe:p,unsubscribe:q,createOffer:r,createAnswer:s,setAnswer:t,addIceCandidate:u,close:v}}var b,c,d,e,f;if("undefined"==typeof module?(e=Peeracle.MediaChannel,f=Peeracle.SignalChannel):(e=require("./mediachannel"),f=require("./signalchannel")),"undefined"==typeof module)b=window.mozRTCIceCandidate||window.webkitRTCIceCandidate||window.RTCIceCandidate,c=window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.RTCPeerConnection,d=window.mozRTCSessionDescription||window.webkitRTCSessionDescription||window.RTCSessionDescription;else{var g=require("wrtc");c=g.RTCPeerConnection,d=g.RTCSessionDescription,b=g.RTCIceCandidate}"undefined"==typeof module?(Peeracle.Peer=a,console.log("browser detected")):module.exports=a}();